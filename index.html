<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/coffee-script/1.2.0/coffee-script.min.js"></script>
		<style>
			#latest-commits-widget{
				border:1px solid #cacaca;
				width:500px;
				height:250px;
				font:13px helvetica, arial, freesans, clean, sans-serif;
				background:#dedede
			}
			#latest-commits-widget a,#latest-commits-widget a:visited{
				color:#4183C4
			}
			#latest-commits-widget a:hover{
				text-decoration:underline
			}
			#latest-commits-widget h3{
				background-color:#e1e1e1;
				background-image:-moz-linear-gradient(top, #f1f1f1, #e1e1e1);
				background-image:-ms-linear-gradient(top, #f1f1f1, #e1e1e1);
				background-image:-o-linear-gradient(top, #f1f1f1, #e1e1e1);
				background-image:-webkit-gradient(linear, left top, left bottom, from(#f1f1f1), to(#e1e1e1));
				background-image:-webkit-linear-gradient(top, #f1f1f1, #e1e1e1);
				background-image:linear-gradient(center top, #f1f1f1 0%, #e1e1e1 100%);
				filter:progid:DXImageTransform.Microsoft.gradient(startColorStr='#f1f1f1', EndColorStr='#e1e1e1');
				border-bottom:1px solid #CACACA;
				color:#111;
				height:30px;
				padding:5px 0 0 5px;
				text-shadow:1px 0 1px rgba(255, 255, 255, .7);
				font-size:1.3em;
				font-weight:bold
			}
			#latest-commits-widget ul#commit-history{
				overflow-y:auto;height:214px}
			#latest-commits-widget ul#commit-history li{
				background-color:#e1e1e1;
				background-image:-moz-linear-gradient(top, #f1f1f1, #e1e1e1);
				background-image:-ms-linear-gradient(top, #f1f1f1, #e1e1e1);
				background-image:-o-linear-gradient(top, #f1f1f1, #e1e1e1);
				background-image:-webkit-gradient(linear, left top, left bottom, from(#f1f1f1), to(#e1e1e1));
				background-image:-webkit-linear-gradient(top, #f1f1f1, #e1e1e1);
				background-image:linear-gradient(center top, #f1f1f1 0%, #e1e1e1 100%);
				filter:progid:DXImageTransform.Microsoft.gradient(startColorStr='#f1f1f1', EndColorStr='#e1e1e1');
				border-bottom:1px solid #CACACA;
				padding:5px
			}
			#latest-commits-widget ul#commit-history li .commit-message{font-size:.8em;text-decoration:none}
			#latest-commits-widget ul#commit-history li .commit-message:hover{text-decoration:underline}
			#latest-commits-widget ul#commit-history li .commit-sha{color:#999;font-size:.8em}
			#latest-commits-widget ul#commit-history li .commit-date{color:#444;font-size:.8em}
			#latest-commits-widget ul#commit-history li .commit-author-info a,#latest-commits-widget ul#commit-history li .commit-author-info a:visited{color:#444;text-decoration:none}

			#latest-commits-widget ul#commit-history li .commit-author-info .commit-avatar{
				height:32px;width:32px;border-radius:4px
			}
	</head>
	<body>
		<div id="latest-commits-widget">
		    <h3>Latest Commits</h3>
		    <ul id="commit-history">
		        
		    </ul>
		</div>

		<script type="text/coffeescript">
			$.extend
			  getUrlVars: ->
			    vars = []
			    hash = undefined
			    hashes = window.location.href.slice(window.location.href.indexOf("?") + 1).split("&")
			    i = 0

			    while i < hashes.length
			      hash = hashes[i].split("=")
			      vars.push hash[0]
			      vars[hash[0]] = hash[1]
			      i++
			    vars

			  getUrlVar: (name) ->
			    $.getUrlVars()[name]

			$ ->
				username = params.username
				repo = params.repo
				limit = params.limit
			  container = $('#latest-commits-widget')

			  ul = $('#commit-history') # the ul element for results
			  limit = 10 # limits the number of results
			  
			  container.find('h3').text("Latest Commits to #{username}/#{repo}")
			  $.ajax(
			      "https://api.github.com/repos/#{username}/#{repo}/commits"
			      data:
			          per_page: limit
			      dataType: "json"
			      type: "get"
			  ).success (response) ->
			      $(ul).empty
			      $(response).each (index, result) ->
			          console.log(result)
			          $(ul).append("""
			              <li>
			              <div class="commit-author-info">
			                  <img class="commit-avatar" src="#{result.author.avatar_url}"> <a href="https://github.com/#{result.author.login}"><b class="commit-author">#{result.author.login}</b></a>
			                  <b class="commit-date">#{$.timeago(result.commit.committer.date)}</b><br /><i class="commit-sha">SHA: #{result.sha}</i>
			              </div>
			              <a class="commit-message" href="https://github.com/#{username}/#{repo}/commit/#{result.sha}" target="_blank">#{result.commit.message}</a>
			              </li>
			          """)
		</script>
	</body>
</html>